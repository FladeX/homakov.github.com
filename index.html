<a href=//egorhomakov.com>Egor Homakov</a> | Stuff: <a href="4sqlet.html">4sq app</a>
<a href="redmine.html">Redmine JS leaking</a> 
<a href="anysquare.html">Clickjacking extractor</a> 
<a href="stealpass.html">Steal pass with XSS demo</a> 
<hr>
<b>ACT — Awesome CSRF Tool</b>
<p>CURL:</p>
<p><textarea rows="4" cols="100" id="curl">curl "http://homakov.blogspot.ru/2013/04/consulting.html" -H "version: HTTP/1.1" --data "key1=val&csrf_token=123qwe&hash[lol]=123"</textarea></p>


<div>
<input onclick="switch_auto()" type="checkbox" id="c1"><label for="c1">Auto-submission</label>
<input type="checkbox" id="c2"><label for="c2">Empty referrer [coming soon]</label>
</div>

<div id="form"></div>
<iframe id="postme" seamless sandbox style="width:800px;height:100px;"></iframe>
<hr>
<p>I am going to create best & simplest CSRF tool ever. Writeup soon. Play with CURL and location hash input — you will love it! Propose your ideas @homakov.<p>

<img src="http://f.cl.ly/items/411t2m0W0n3h1k3g2F3w/Screen%20Shot%202013-05-05%20at%209.31.54%20PM.png"><p>

<script>

var match_re = '"([^"]+)"';
var url_re = new RegExp('curl '+match_re);
var headers_re = new RegExp('-H '+match_re);
var data_re = new RegExp('--data '+match_re);
var form_obj = {};

function parse_data(data){
  var res = {};
  var vars = data.split('&');
  for (var i = 0; i < vars.length; i++) {
    if(vars[i].length){
      var pair = vars[i].split('=');
      res[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
    }
  }
  return res;
}

function dump_data(data){
  var res = '';
  for(var k in data){
    res += encodeURIComponent(k)+'='+encodeURIComponent(data[k])+'&';
  }
  return res;
}

function submit_to(to){
  genform.target = to;
  genform.submit();
  return false;
}

function switch_method(){
  var swap = (form_obj.method == 'GET') ? 'POST' : 'GET'
  form_obj.method = swap;
  update_form();
}

function switch_url(url){
  form_obj.url = url;
  update_form();
}

function switch_auto(){
  form_obj.autosubmit = !form_obj.autosubmit;
  update_form();
}

function get_html(){
  //genform.getElementsByTagName('input')
  alert(genform.parentNode.innerHTML);
}
function generate_form(obj){
  var inputs = '';
  if(obj.data){
    var pairs = parse_data(obj.data);
    inputs += '<table>';

    for(var k in pairs){
      inputs += '<tr><td>'+k+' </td><td><input size=100 name="'+esc(k)+'" value="'+esc(pairs[k])+'"><a onclick="this.parentNode.parentNode.remove();">[X]</a></td></tr>';
    }
    inputs += '</table>';
  }
  var out = '<p><a id="cur_method" title="Switch?" href="javascript:switch_method()">'+obj.method+'</a> <input size=120 value="'+esc(obj.url)+'" onchange="switch_url(this.value);"> </p>';
  out += '<div><form id="genform" action="'+esc(obj.url)+'" method="'+obj.method+'">'+inputs+'</form></div>';
  out += '<p><input type="submit" onclick="return submit_to(\'_blank\')" value="New window"><input type="submit" onclick="return submit_to(\'_top\')" value="This window"><input type="submit" onclick="return submit_to(\'postme\')" value="Iframe below"> | <input type="submit" value="Get HTML" onclick="get_html();"></p>';

  out = '<div class="yelo">'+out+'</div>';

  return out;
}

function esc(quote){
  return quote.replace(/"/g,'\\"')
}


function parse_curl(){
  var input = curl.value;
  form_obj ={
    url: input.match(url_re)[1],
    autosubmit: false,
    target: '_top'
  }

  if(data = input.match(data_re)){
    form_obj.data = data[1];
    form_obj.method = 'POST';
  }else{
    form_obj.method = 'GET';
  }

  update_form();
}

function dump_hash(){
  location.hash = JSON.stringify(form_obj);
}

function update_form(){
  form.innerHTML = generate_form(form_obj);
  dump_hash(); //updating form? update hash too!
}


curl.onchange = parse_curl;

window.onload = function(){
  if(location.hash){
    //lets load CSRF template
    curl.value = '';
    form_obj = JSON.parse(location.hash.substr(1));
    form.innerHTML = generate_form(form_obj);
    if(form_obj.autosubmit){
      submit_to(form_obj.target);
    }
  }else{
    //demo
    parse_curl();
  }

}
</script>

<style>
.yelo{
  background-color: yellow;
}
</style>


