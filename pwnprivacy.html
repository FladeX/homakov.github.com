<p>URL Detection</p>

onload-based

X-Frame-Options-based



history-based
<script>

var wins = []
var timeout = 9000;
var direct_history = false;
var data_timeout = 2000;



window.onmessage=function(e){
  debug('Received: '+ e.data.result + ' for '+e.data.id)

  if(wins[e.data.id].started){
    debug('Processing time (ms): '+ (new Date - wins[e.data.id].started))
    wins[e.data.id].cb(e.data);
    wins[e.data.id].w.history.go(e.data.result ? 1 : 2)
  }
}
var debug=function(d){
  deb.innerHTML+="<br>"+d;
}

var path_for = function(result,id){
  return '/postback.html#'+result+','+id
  //'data:text/html,<script>opener.postMessage({result: false,id:'+id+'},"*")<'+'/script>'
}

var check_redirect = function(base, cb, assigner){
  var id = wins.length;

  wins[id] = {
    w: window.open(path_for(false,id)),
    started: false,
    cb: cb
  }

  setTimeout(function(){
    wins[id].w.location=path_for(true,id);
  },data_timeout)

  setTimeout(function(){
    wins[id].w.location = base;

    setTimeout(function(){
      debug('Started at '+ (wins[id].started = new Date))

      if(assigner){
        assigner(wins[id].w);
      }else{
        // check exactly same URL
        wins[id].w.location = base+'#';
      }
      setTimeout(function(){
        if(direct_history){
          wins[id].w.history.go(-2);
        }else{
          wins[id].w.location = '/go_back.html'
        }
      },100)
    },timeout)
  },data_timeout*2)
}

</script>

<br><a href=# onclick=window.eval(ev.value)>Run</a>
<br>
<textarea id=ev style="width:600px;height:200px;"></textarea>
<b><div id=deb></div></b>

<pre>
Examples:

check_redirect('https://github.com/notifications', function(result){
  debug('Logged in on github '+result.result);
})

check_redirect('https://www.facebook.com/messages/new', function(result){
  console.log('Logged in on fb ',result.result);
})

check_redirect('https://www.facebook.com/dialog/oauth?client_id=114545895322903&redirect_uri=https%3A%2F%2Fm.facebook.com', function(result){
  console.log('authorized app ',result.result);
})
https://www.facebook.com/messages/name
</pre>